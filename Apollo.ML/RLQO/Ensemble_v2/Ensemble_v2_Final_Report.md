# Ensemble v2 ìµœì¢… í‰ê°€ ë³´ê³ ì„œ

**ìƒì„±ì¼**: 2025-10-30  
**í‰ê°€ ëŒ€ìƒ**: Ensemble v2 (4-Model Ensemble: DQN v4, PPO v3, DDPG v1, SAC v1)  
**í‰ê°€ ê·œëª¨**: 30 ì¿¼ë¦¬ Ã— 10 ì—í”¼ì†Œë“œ = 300íšŒ  
**íˆ¬í‘œ ì „ëµ**: Majority Voting  

---

## ğŸ“‹ **ëª©ì°¨**

1. [ì „ì²´ ìš”ì•½](#1-ì „ì²´-ìš”ì•½)
2. [ì£¼ìš” ê°œì„ ì‚¬í•­ (v1 â†’ v2)](#2-ì£¼ìš”-ê°œì„ ì‚¬í•­-v1--v2)
3. [ì„±ëŠ¥ ë©”íŠ¸ë¦­](#3-ì„±ëŠ¥-ë©”íŠ¸ë¦­)
4. [ì¿¼ë¦¬ë³„ ìƒì„¸ ê²°ê³¼](#4-ì¿¼ë¦¬ë³„-ìƒì„¸-ê²°ê³¼)
5. [ì¿¼ë¦¬ íƒ€ì…ë³„ ë¶„ì„](#5-ì¿¼ë¦¬-íƒ€ì…ë³„-ë¶„ì„)
6. [ì•¡ì…˜ íš¨ê³¼ì„± ë¶„ì„](#6-ì•¡ì…˜-íš¨ê³¼ì„±-ë¶„ì„)
7. [ì£¼ìš” ë°œê²¬ì‚¬í•­](#7-ì£¼ìš”-ë°œê²¬ì‚¬í•­)
8. [ë¬¸ì œì  ë° í•´ê²° ê³¼ì œ](#8-ë¬¸ì œì -ë°-í•´ê²°-ê³¼ì œ)
9. [ê²°ë¡ ](#9-ê²°ë¡ )

---

## 1. ì „ì²´ ìš”ì•½

### 1.1 í•µì‹¬ ì„±ëŠ¥ ì§€í‘œ

| ì§€í‘œ | ê°’ | í‰ê°€ |
|------|-----|------|
| **Mean Speedup** | **1.051x** | 5% ê°œì„  |
| **Median Speedup** | **1.000x** | ì¤‘ê°„ê°’ì€ ë³€í™” ì—†ìŒ |
| **Win Rate** | **19.7%** | ì•½ 1/5 ì¿¼ë¦¬ì—ì„œ ê°œì„  |
| **Safe Rate** | **61.0%** | ê³¼ë°˜ìˆ˜ì—ì„œ ì•ˆì „ |
| **Total Episodes** | **300íšŒ** | 30 ì¿¼ë¦¬ Ã— 10 ì—í”¼ì†Œë“œ |

### 1.2 í‰ê°€ ìš”ì•½

**ê¸ì •ì  ì¸¡ë©´:**
- âœ… DDPG v1, SAC v1 ëª¨ë¸ í™œì„±í™” ì„±ê³µ (v1ì—ì„œëŠ” ì™„ì „íˆ ë¹„í™œì„±í™”)
- âœ… PPO v3 ì•¡ì…˜ ë§¤í•‘ êµ¬í˜„ìœ¼ë¡œ 44â†’19 ì•¡ì…˜ ë³€í™˜ ì„±ê³µ
- âœ… `OPTION (RECOMPILE)` ì ìš©ìœ¼ë¡œ ì¿¼ë¦¬ ìºì‹œ ì´ìŠˆ í•´ê²°
- âœ… ì¼ë¶€ ì¿¼ë¦¬ì—ì„œ ì˜ë¯¸ìˆëŠ” ì„±ëŠ¥ ê°œì„  (Query 10: 1.161x, Query 21: 1.117x)

**ë¶€ì •ì  ì¸¡ë©´:**
- âŒ ì „ì²´ì ìœ¼ë¡œ ë‚®ì€ Win Rate (19.7%)
- âŒ TOP, JOIN_HEAVY ì¿¼ë¦¬ì—ì„œ ì„±ëŠ¥ ì €í•˜ (v1ì—ì„œ ëª©í‘œë¡œ í–ˆë˜ ì˜ì—­)
- âŒ 20% ì¿¼ë¦¬ì—ì„œ ì‹¤í–‰ ì‹¤íŒ¨ (0ms ë°˜í™˜): Query 11, 12, 15, 23, 26, 29
- âŒ ì¼ë¶€ ì¿¼ë¦¬ì—ì„œ ì‹¬ê°í•œ ì„±ëŠ¥ ì €í•˜ (Query 24: 0.277x, Query 27: 0.400x)

### 1.3 ì‹œê°í™” ìš”ì•½

#### ì „ì²´ ì„±ëŠ¥ ë¶„í¬
![ì „ì²´ ì„±ëŠ¥ ë¶„ì„](charts/chart3_overall_analysis.png)

*ê·¸ë¦¼ 1: ì „ì²´ ì„±ëŠ¥ ë¶„í¬ (íŒŒì´ ì°¨íŠ¸), í•µì‹¬ í†µê³„, Win Rate vs Safe Rate ì‚°ì ë„*

---

## 2. ì£¼ìš” ê°œì„ ì‚¬í•­ (v1 â†’ v2)

### 2.1 ê¸°ìˆ ì  ê°œì„ 

#### A. **Continuous-to-Discrete ë³€í™˜ ë¡œì§ êµ¬í˜„**
- **íŒŒì¼**: `action_converter.py`
- **ëª©ì **: DDPG v1, SAC v1ì˜ ì—°ì† ì•¡ì…˜ì„ DQN v4ì˜ ì´ì‚° ì•¡ì…˜(0-18)ìœ¼ë¡œ ë³€í™˜
- **ë°©ë²•**: 
  - 7ì°¨ì› ì—°ì† ë²¡í„°ë¥¼ SQL íŒíŠ¸ë¡œ ë””ì½”ë”©
  - ìš°ì„ ìˆœìœ„ ê¸°ë°˜ ë§¤í•‘ (JOIN â†’ FAST â†’ MAXDOP â†’ RECOMPILE)
- **ê²°ê³¼**: âœ… **ì„±ê³µ** - DDPG/SAC ëª¨ë¸ì´ íˆ¬í‘œì— ì°¸ì—¬í•˜ê¸° ì‹œì‘

#### B. **PPO v3 ì•¡ì…˜ ë§¤í•‘ êµ¬í˜„**
- **íŒŒì¼**: `ppo_action_mapper.py`
- **ëª©ì **: PPO v3ì˜ 44ê°œ ì•¡ì…˜ì„ DQN v4ì˜ 19ê°œ ì•¡ì…˜ìœ¼ë¡œ ë³€í™˜
- **ë°©ë²•**:
  - ì˜ë¯¸ ê¸°ë°˜ ê·¼ì‚¬ ë§¤í•‘ (ì˜ˆ: FAST 10 â†’ FAST 5, MAXDOP 8 â†’ MAXDOP 4)
  - ISOLATION ë ˆë²¨ â†’ NO_ACTION (DQNì— ì—†ìŒ)
  - ê³ ê¸‰ íŒíŠ¸ â†’ NO_ACTION
- **ê²°ê³¼**: âœ… **ì„±ê³µ** - PPO ì˜ˆì¸¡ì´ ë¼ìš°í„° ì°¨ë‹¨ ì—†ì´ í†µê³¼

#### C. **Query Cache ì´ìŠˆ í•´ê²°**
- **íŒŒì¼**: `DQN_v4/env/v4_db_env.py` (modified)
- **ë¬¸ì œ**: SQL Server ì¿¼ë¦¬ í”Œëœ ìºì‹œë¡œ ì¸í•´ optimized_msê°€ í•­ìƒ 1.0ms
- **í•´ê²°**: ëª¨ë“  SQL ì¿¼ë¦¬ì— `OPTION (RECOMPILE)` ìë™ ì¶”ê°€
- **ê²°ê³¼**: âœ… **ì„±ê³µ** - ì •í™•í•œ ì‹¤í–‰ ì‹œê°„ ì¸¡ì • ê°€ëŠ¥

#### D. **íˆ¬í‘œ ì „ëµ ë³€ê²½**
- **v1**: Safety-First Voting (ë§¤ìš° ë³´ìˆ˜ì )
- **v2 ì´ˆê¸°**: Safety-First (disagreement_threshold=0.25) â†’ ëª¨ë“  ì•¡ì…˜ì´ NO_ACTION
- **v2 ìˆ˜ì •**: Safety-First (disagreement_threshold=0.1) â†’ ì—¬ì „íˆ ë³´ìˆ˜ì 
- **v2 ìµœì¢…**: **Majority Voting** â†’ ê°€ì¥ ë§ì€ íˆ¬í‘œë¥¼ ë°›ì€ ì•¡ì…˜ ì„ íƒ

### 2.2 ì•„í‚¤í…ì²˜ ê°œì„ 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Ensemble v2 ì•„í‚¤í…ì²˜                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ DQN v4  â”‚  â”‚ PPO v3  â”‚  â”‚ DDPG v1 â”‚  â”‚ SAC v1  â”‚      â”‚
â”‚  â”‚ (19 act)â”‚  â”‚ (44 act)â”‚  â”‚ (7 cont)â”‚  â”‚ (7 cont)â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â”‚
â”‚       â”‚            â”‚             â”‚             â”‚           â”‚
â”‚       â”‚       â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”     â”‚
â”‚       â”‚       â”‚ PPOâ†’DQN  â”‚  â”‚ Contâ†’   â”‚  â”‚ Contâ†’   â”‚     â”‚
â”‚       â”‚       â”‚ Mapper   â”‚  â”‚ Discreteâ”‚  â”‚ Discreteâ”‚     â”‚
â”‚       â”‚       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â”‚
â”‚       â”‚            â”‚             â”‚             â”‚           â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                â”‚                                            â”‚
â”‚           â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚           â”‚ Majority Vote â”‚                                â”‚
â”‚           â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                â”‚                                            â”‚
â”‚           â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚           â”‚ Query Router  â”‚ (í•„í„°ë§ ë¹„í™œì„±í™”)                â”‚
â”‚           â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                â”‚                                            â”‚
â”‚           â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚           â”‚Action Validatorâ”‚ (í•„í„°ë§ ì™„í™”)                   â”‚
â”‚           â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                â”‚                                            â”‚
â”‚           â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚           â”‚  Final Action â”‚                                â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. ì„±ëŠ¥ ë©”íŠ¸ë¦­

### 3.1 ì „ì²´ ì„±ëŠ¥ ë¶„í¬

| ë¶„ë¥˜ | ì¿¼ë¦¬ ìˆ˜ | ë¹„ìœ¨ | ì—í”¼ì†Œë“œ ìˆ˜ |
|------|---------|------|-------------|
| âœ… **ê°œì„ ** (Speedup > 1.05x) | 3 | 10.0% | 30 |
| âš ï¸ **ë¶ˆë³€** (0.95x â‰¤ Speedup â‰¤ 1.05x) | 14 | 46.7% | 140 |
| ğŸ”´ **ì €í•˜** (Speedup < 0.95x) | 13 | 43.3% | 130 |

### 3.2 Top 3 ê°œì„  ì¿¼ë¦¬

| Rank | Query | Name | Baseline | Speedup | Win% | Safe% |
|------|-------|------|----------|---------|------|-------|
| ğŸ¥‡ | Query 8 | í¬ì§€ì…˜ ìˆ˜ìµë¥  ë¶„ì„ (CTE) | 100ms | **10.000x** | 10% | 10% |
| ğŸ¥ˆ | Query 10 | ë‹¹ì¼ ê±°ë˜ëŒ€ê¸ˆ ìƒìœ„ ì¢…ëª© (TOP) | 7ms | **1.161x** | 50% | 70% |
| ğŸ¥‰ | Query 21 | ì¢…ëª©ë³„ ìµœê·¼ ê°€ê²© ì´ë ¥ (TOP) | 1ms | **1.117x** | 20% | 60% |

**ì£¼ì˜**: Query 8ì˜ 10x ê°œì„ ì€ ë°ì´í„° ì—†ìŒìœ¼ë¡œ ì¸í•œ ì°©ì‹œ íš¨ê³¼

### 3.3 Bottom 5 ì €í•˜ ì¿¼ë¦¬

| Rank | Query | Name | Baseline | Speedup | Win% | Safe% | ìƒíƒœ |
|------|-------|------|----------|---------|------|-------|------|
| ğŸ”´ | Query 11 | ì „ì¼ ì¢…ê°€ ëŒ€ë¹„ ë“±ë½ë¥  ìƒìœ„ ì¢…ëª© (CTE) | 85ms | **0.000x** | 0% | 0% | ì‹¤í–‰ ì‹¤íŒ¨ |
| ğŸ”´ | Query 12 | ê³„ì¢Œë³„ í¬ì§€ì…˜ í‰ê°€ (TOP) | 100ms | **0.000x** | 0% | 0% | ì‹¤í–‰ ì‹¤íŒ¨ |
| ğŸ”´ | Query 15 | ìµœê·¼ ê±°ë˜ ëª¨ë‹ˆí„°ë§ (JOIN_HEAVY) | 100ms | **0.000x** | 0% | 0% | ì‹¤í–‰ ì‹¤íŒ¨ |
| ğŸ”´ | Query 23 | ë¦¬ìŠ¤í¬ ë…¸ì¶œë„ ìŠ¤ëƒ…ìƒ· ì¡°íšŒ (TOP) | 100ms | **0.000x** | 0% | 0% | ì‹¤í–‰ ì‹¤íŒ¨ |
| ğŸ”´ | Query 24 | ê³„ì¢Œë³„ ì£¼ë¬¸ ì†ŒìŠ¤ ë¶„í¬ (AGGREGATE) | 23ms | **0.277x** | 0% | 20% | ì‹¬ê°í•œ ì €í•˜ |

### 3.4 ì¿¼ë¦¬ë³„ ì„±ëŠ¥ ì‹œê°í™”

![ì¿¼ë¦¬ë³„ Speedup](charts/chart1_query_speedup.png)

*ê·¸ë¦¼ 2: 30ê°œ ì¿¼ë¦¬ë³„ Speedup ë°” ì°¨íŠ¸ (ì´ˆë¡: ê°œì„ , íšŒìƒ‰: ë¶ˆë³€, ë¹¨ê°•: ì €í•˜)*

---

## 4. ì¿¼ë¦¬ë³„ ìƒì„¸ ê²°ê³¼

### 4.1 ì „ì²´ 30ê°œ ì¿¼ë¦¬ ì„±ëŠ¥í‘œ

| Idx | Query Name | Type | Baseline | Mean Speedup | Win% | Safe% | í‰ê°€ |
|-----|------------|------|----------|--------------|------|-------|------|
| 0 | ê³„ì¢Œë³„ ì¼ë³„ ê±°ë˜ í†µê³„ | JOIN_HEAVY | 22ms | 0.915x | 40.0% | 60.0% | âš ï¸ ì €í•˜ |
| 1 | ê±°ë˜ì†Œë³„ ì¢…ëª©ë³„ í‰ê·  ì²´ê²°ê°€ê²©ê³¼ ê±°ë˜ëŸ‰ | CTE | 8ms | 1.000x | 0.0% | 100.0% | âœ… ì•ˆì • |
| 2 | ëŒ€ìš©ëŸ‰ í…Œì´ë¸” ì „ì²´ ìŠ¤ìº” | SIMPLE | 957ms | 0.970x | 40.0% | 50.0% | âš ï¸ ì•½ê°„ ì €í•˜ |
| 3 | 2-way JOIN | TOP | 434ms | 0.919x | 60.0% | 90.0% | âš ï¸ ì €í•˜ |
| 4 | 3-way JOIN + ORDER BY | TOP | 2ms | 1.000x | 0.0% | 100.0% | âœ… ì•ˆì • |
| 5 | NOT EXISTS | SUBQUERY | 629ms | 1.000x | 0.0% | 100.0% | âœ… ì•ˆì • |
| 6 | RAND | SIMPLE | 38ms | 1.033x | 60.0% | 90.0% | âœ… ì•½ê°„ ê°œì„  |
| 7 | ì£¼ë¬¸ ì²´ê²°ë¥ ê³¼ í‰ê·  ìŠ¬ë¦¬í”¼ì§€ ë¶„ì„ | JOIN_HEAVY | 27ms | 1.033x | 60.0% | 90.0% | âœ… ì•½ê°„ ê°œì„  |
| 8 | í¬ì§€ì…˜ ìˆ˜ìµë¥  ë¶„ì„ | CTE | 100ms | 10.000x | 10.0% | 10.0% | âš ï¸ ë°ì´í„° ì—†ìŒ |
| 9 | ë‹¹ì¼ ê±°ë˜ëŸ‰ ìƒìœ„ ì¢…ëª© | TOP | 3ms | 0.937x | 30.0% | 60.0% | âš ï¸ ì•½ê°„ ì €í•˜ |
| 10 | ë‹¹ì¼ ê±°ë˜ëŒ€ê¸ˆ ìƒìœ„ ì¢…ëª© | TOP | 7ms | 1.161x | 50.0% | 70.0% | âœ… ê°œì„  |
| 11 | ì „ì¼ ì¢…ê°€ ëŒ€ë¹„ ë“±ë½ë¥  ìƒìœ„ ì¢…ëª© | CTE | 85ms | 0.000x | 0.0% | 0.0% | ğŸ”´ ì‹¤íŒ¨ |
| 12 | ê³„ì¢Œë³„ í¬ì§€ì…˜ í‰ê°€ | TOP | 100ms | 0.000x | 0.0% | 0.0% | ğŸ”´ ì‹¤íŒ¨ |
| 13 | ë¯¸ì²´ê²° ì£¼ë¬¸ ëª©ë¡ | TOP | 81ms | 1.037x | 50.0% | 100.0% | âœ… ì•½ê°„ ê°œì„  |
| 14 | ìµœê·¼ ëŒ€ëŸ‰ ì£¼ë¬¸ ê²€ìƒ‰ | TOP | 30ms | 0.956x | 30.0% | 60.0% | âš ï¸ ì•½ê°„ ì €í•˜ |
| 15 | ìµœê·¼ ê±°ë˜ ëª¨ë‹ˆí„°ë§ | JOIN_HEAVY | 100ms | 0.000x | 0.0% | 0.0% | ğŸ”´ ì‹¤íŒ¨ |
| 16 | ì£¼ë¬¸ê³¼ ì²´ê²° ë‚´ì—­ í•¨ê»˜ ì¡°íšŒ | JOIN_HEAVY | 27ms | 1.007x | 60.0% | 80.0% | âœ… ì•ˆì • |
| 17 | ì²´ê²° ë‚´ì—­ì´ ìˆëŠ” ì£¼ë¬¸ë§Œ ì¡°íšŒ (EXISTS) | SUBQUERY | 29ms | 1.000x | 0.0% | 100.0% | âœ… ì•ˆì • |
| 18 | ì²´ê²° ë‚´ì—­ì´ ìˆëŠ” ì£¼ë¬¸ë§Œ ì¡°íšŒ (IN) | SUBQUERY | 27ms | 1.000x | 0.0% | 100.0% | âœ… ì•ˆì • |
| 19 | ê³„ì¢Œë³„ í˜„ê¸ˆ ì”ì•¡ ì¡°íšŒ | WINDOW | 2ms | 0.900x | 10.0% | 70.0% | âš ï¸ ì €í•˜ |
| 20 | ê±°ë˜ì†Œë³„ ì¢…ëª© ìˆ˜ ë° í†µê³„ | AGGREGATE | 6ms | 1.000x | 0.0% | 100.0% | âœ… ì•ˆì • |
| 21 | ì¢…ëª©ë³„ ìµœê·¼ ê°€ê²© ì´ë ¥ | TOP | 1ms | 1.117x | 20.0% | 60.0% | âœ… ê°œì„  |
| 22 | ê³ ê°ë³„ ê³„ì¢Œ ë° ì”ì•¡ ìš”ì•½ | AGGREGATE | 62ms | 1.000x | 0.0% | 100.0% | âœ… ì•ˆì • |
| 23 | ë¦¬ìŠ¤í¬ ë…¸ì¶œë„ ìŠ¤ëƒ…ìƒ· ì¡°íšŒ | TOP | 100ms | 0.000x | 0.0% | 0.0% | ğŸ”´ ì‹¤íŒ¨ |
| 24 | ê³„ì¢Œë³„ ì£¼ë¬¸ ì†ŒìŠ¤ ë¶„í¬ | AGGREGATE | 23ms | 0.277x | 0.0% | 20.0% | ğŸ”´ ì‹¬ê° |
| 25 | ì¢…ëª© íƒ€ì…ë³„ ê±°ë˜ í†µê³„ | JOIN_HEAVY | 51ms | 0.975x | 40.0% | 90.0% | âš ï¸ ì•½ê°„ ì €í•˜ |
| 26 | ë§ˆì§„ ê³„ì¢Œ ìƒíƒœ ì¡°íšŒ | JOIN_HEAVY | 100ms | 0.000x | 0.0% | 0.0% | ğŸ”´ ì‹¤íŒ¨ |
| 27 | ì»´í”Œë¼ì´ì–¸ìŠ¤ ê²½ê³  í˜„í™© | JOIN_HEAVY | 1ms | 0.400x | 0.0% | 40.0% | ğŸ”´ ì‹¬ê° |
| 28 | ê±°ë˜ ì›ì¥ ì§‘ê³„ vs í¬ì§€ì…˜ ê²€ì¦ | JOIN_HEAVY | 276ms | 0.884x | 30.0% | 90.0% | âš ï¸ ì €í•˜ |
| 29 | ì¢…ëª©ë³„ ì‹œì„¸ ë³€ë™ì„± ë¶„ì„ | AGGREGATE | 8ms | 0.000x | 0.0% | 0.0% | ğŸ”´ ì‹¤íŒ¨ |

---

## 5. ì¿¼ë¦¬ íƒ€ì…ë³„ ë¶„ì„

### 5.1 íƒ€ì…ë³„ ì„±ëŠ¥ ìš”ì•½

| Type | ì¿¼ë¦¬ ìˆ˜ | ì—í”¼ì†Œë“œ | Mean Speedup | Median | Win% | Safe% | í‰ê°€ |
|------|---------|----------|--------------|--------|------|-------|------|
| **CTE** | 3 | 30 | **3.667x** | 1.000x | 3.3% | 36.7% | âš ï¸ Query 8 ì°©ì‹œ |
| **SIMPLE** | 2 | 20 | **1.001x** | 1.002x | 50.0% | 70.0% | âœ… ê°€ì¥ ì•ˆì •ì  |
| **SUBQUERY** | 3 | 30 | **1.000x** | 1.000x | 0.0% | 100.0% | âœ… ë§¤ìš° ì•ˆì „ |
| **WINDOW** | 1 | 10 | **0.900x** | 0.900x | 10.0% | 70.0% | âš ï¸ ì•½ê°„ ì €í•˜ |
| **TOP** | 9 | 90 | **0.792x** | 1.000x | 26.7% | 60.0% | ğŸ”´ ì—­íš¨ê³¼ |
| **JOIN_HEAVY** | 8 | 80 | **0.652x** | 0.945x | 28.7% | 56.2% | ğŸ”´ ì‹¬ê°í•œ ì—­íš¨ê³¼ |
| **AGGREGATE** | 4 | 40 | **0.569x** | 0.639x | 0.0% | 55.0% | ğŸ”´ ì‹¬ê°í•œ ì—­íš¨ê³¼ |

#### íƒ€ì…ë³„ ì„±ëŠ¥ ë¹„êµ ì‹œê°í™”

![ì¿¼ë¦¬ íƒ€ì…ë³„ ì„±ëŠ¥ ë¹„êµ](charts/chart2_type_comparison.png)

*ê·¸ë¦¼ 3: ì¿¼ë¦¬ íƒ€ì…ë³„ ì„±ëŠ¥ ë¹„êµ (í‰ê·  Speedup, Win Rate, Safe Rate)*

### 5.2 íƒ€ì…ë³„ ìƒì„¸ ë¶„ì„

#### ğŸ”´ **TOP ì¿¼ë¦¬ (ëª©í‘œ ê°œì„  ëŒ€ìƒì´ì—ˆìœ¼ë‚˜ ì‹¤íŒ¨)**
- **í‰ê·  ì„±ëŠ¥**: 0.792x (21% ì €í•˜)
- **ë¬¸ì œ ì¿¼ë¦¬**:
  - Query 3 (2-way JOIN): 0.919x
  - Query 9 (ë‹¹ì¼ ê±°ë˜ëŸ‰ ìƒìœ„): 0.937x
  - Query 12, 23: ì‹¤í–‰ ì‹¤íŒ¨ (0.000x)
- **ì„±ê³µ ì¿¼ë¦¬**:
  - Query 10: 1.161x
  - Query 21: 1.117x
  - Query 13: 1.037x
- **ê²°ë¡ **: âŒ **v1ì˜ ì£¼ìš” ëª©í‘œì˜€ë˜ TOP ì¿¼ë¦¬ ê°œì„  ì‹¤íŒ¨**

#### ğŸ”´ **JOIN_HEAVY ì¿¼ë¦¬**
- **í‰ê·  ì„±ëŠ¥**: 0.652x (35% ì €í•˜)
- **ë¬¸ì œ**:
  - Query 15, 26: ì‹¤í–‰ ì‹¤íŒ¨
  - Query 0, 28: 10% ì´ìƒ ì €í•˜
  - Query 27: 60% ì €í•˜ (ì‹¬ê°)
- **ê²°ë¡ **: âŒ **JOIN íŒíŠ¸ê°€ ì—­íš¨ê³¼ë¥¼ ëƒ„**

#### ğŸ”´ **AGGREGATE ì¿¼ë¦¬**
- **í‰ê·  ì„±ëŠ¥**: 0.569x (43% ì €í•˜)
- **ë¬¸ì œ**:
  - Query 24: 0.277x (73% ì €í•˜)
  - Query 29: ì‹¤í–‰ ì‹¤íŒ¨
  - Query 20, 22: ë³€í™” ì—†ìŒ (1.000x)
- **ê²°ë¡ **: âŒ **ê°€ì¥ ì„±ëŠ¥ì´ ë‚˜ìœ ì¹´í…Œê³ ë¦¬**

#### âœ… **SIMPLE ì¿¼ë¦¬**
- **í‰ê·  ì„±ëŠ¥**: 1.001x (ë¯¸ë¯¸í•œ ê°œì„ )
- **ì•ˆì „ì„±**: Safe Rate 70%
- **ê²°ë¡ **: âœ… **ê°€ì¥ ì•ˆì •ì ì¸ ì¹´í…Œê³ ë¦¬**

#### âœ… **SUBQUERY ì¿¼ë¦¬**
- **í‰ê·  ì„±ëŠ¥**: 1.000x (ë³€í™” ì—†ìŒ)
- **ì•ˆì „ì„±**: Safe Rate 100%
- **ê²°ë¡ **: âœ… **ê°€ì¥ ì•ˆì „í•˜ì§€ë§Œ ê°œì„  ì—¬ì§€ ì—†ìŒ**

---

## 6. ì•¡ì…˜ íš¨ê³¼ì„± ë¶„ì„

### 6.1 ì•¡ì…˜ë³„ ì„±ëŠ¥ (ì¶”ì •)

ê°€ì¥ ìì£¼ ì„ íƒëœ ì•¡ì…˜ê³¼ ê·¸ íš¨ê³¼:

| Action | ì˜ˆìƒ ë¹ˆë„ | ì£¼ìš” íš¨ê³¼ | í‰ê°€ |
|--------|-----------|-----------|------|
| **NO_ACTION (18)** | ë†’ìŒ | ì•ˆì „í•œ ê¸°ë³¸ê°’, ì‹¤ì œë¡œ ê°€ì¥ íš¨ê³¼ì  | âœ… ê°€ì¥ ì•ˆì „ |
| **LOOP_JOIN (5)** | ë†’ìŒ | JOIN_HEAVY ì¿¼ë¦¬ì—ì„œ ì¼ê´€ë˜ê²Œ ì—­íš¨ê³¼ | âŒ ì—­íš¨ê³¼ |
| **FAST N (14-16)** | ì¤‘ê°„ | TOP ì¿¼ë¦¬ì—ì„œ í˜¼ì¬ëœ ê²°ê³¼ | âš ï¸ ë¶ˆí™•ì‹¤ |
| **RECOMPILE (7)** | ë‚®ìŒ | ì´ë¯¸ ëª¨ë“  ì¿¼ë¦¬ì— ìë™ ì¶”ê°€ë¨ | - ì¤‘ë³µ |
| **MAXDOP (0-2)** | ë‚®ìŒ | íš¨ê³¼ ë¯¸ë¯¸ | âš ï¸ ë¶ˆí™•ì‹¤ |

### 6.2 ì£¼ìš” ë°œê²¬ì‚¬í•­

1. **NO_ACTIONì´ ê°€ì¥ ì•ˆì „í•˜ê³  íš¨ê³¼ì **
   - Safe Rate 100% ë‹¬ì„±í•œ ì¿¼ë¦¬ë“¤ì€ ëŒ€ë¶€ë¶„ NO_ACTION ì„ íƒ
   - ë¬´ì‘ìœ„ íŒíŠ¸ë³´ë‹¤ ê¸°ë³¸ í”Œëœì´ ë” ë‚˜ì€ ê²½ìš°ê°€ ë§ìŒ

2. **LOOP_JOINì˜ ì¼ê´€ëœ ì—­íš¨ê³¼**
   - JOIN_HEAVY ì¿¼ë¦¬ì—ì„œ í‰ê·  35% ì €í•˜
   - SQL Serverì˜ ì˜µí‹°ë§ˆì´ì €ê°€ ì´ë¯¸ ì ì ˆí•œ ì¡°ì¸ ë°©ì‹ ì„ íƒ

3. **FAST Nì˜ ì œí•œì  íš¨ê³¼**
   - Query 10ì—ì„œ íš¨ê³¼ì  (1.161x)
   - ëŒ€ë¶€ë¶„ì˜ TOP ì¿¼ë¦¬ì—ì„œëŠ” íš¨ê³¼ ì—†ê±°ë‚˜ ì—­íš¨ê³¼

---

## 7. ì£¼ìš” ë°œê²¬ì‚¬í•­

### 7.1 ê¸°ìˆ ì  ë°œê²¬

#### âœ… **ì„±ê³µí•œ ë¶€ë¶„**

1. **ëª¨ë¸ í™œì„±í™”**
   - DDPG v1, SAC v1ì´ íˆ¬í‘œì— ì°¸ì—¬í•˜ê¸° ì‹œì‘
   - PPO v3ì˜ 44ê°œ ì•¡ì…˜ì´ 19ê°œë¡œ ì„±ê³µì ìœ¼ë¡œ ë§¤í•‘ë¨
   - 4ê°œ ëª¨ë¸ì´ ëª¨ë‘ ì˜ˆì¸¡ ìƒì„± í™•ì¸

2. **ì¿¼ë¦¬ ìºì‹œ í•´ê²°**
   - `OPTION (RECOMPILE)` ìë™ ì¶”ê°€ë¡œ ì •í™•í•œ ì¸¡ì • ê°€ëŠ¥
   - ì´ì „ì—ëŠ” 1.0msë¡œ ê³ ì •ë˜ë˜ ë¬¸ì œ í•´ê²°

3. **ì•„í‚¤í…ì²˜ í†µí•©**
   - ì„œë¡œ ë‹¤ë¥¸ ì•¡ì…˜ ìŠ¤í˜ì´ìŠ¤ë¥¼ ê°€ì§„ 4ê°œ ëª¨ë¸ í†µí•© ì„±ê³µ
   - ëª¨ë“ˆí™”ëœ êµ¬ì¡°ë¡œ ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ

#### âŒ **ì‹¤íŒ¨í•œ ë¶€ë¶„**

1. **ë‚®ì€ Win Rate (19.7%)**
   - 5ë²ˆ ì¤‘ 4ë²ˆì€ ê°œì„  ì‹¤íŒ¨
   - v1ì—ì„œ ëª©í‘œë¡œ í–ˆë˜ ì„±ëŠ¥ í–¥ìƒ ë¯¸ë‹¬ì„±

2. **ì‹¤í–‰ ì‹¤íŒ¨ (20% ì¿¼ë¦¬)**
   - Query 11, 12, 15, 23, 26, 29ê°€ 0ms ë°˜í™˜
   - ì›ì¸: íƒ€ì„ì•„ì›ƒ, íŠ¹ì • ì•¡ì…˜ê³¼ì˜ ì¶©ëŒ, ë˜ëŠ” ë°ì´í„° ì´ìŠˆ

3. **ì—­íš¨ê³¼ ì•¡ì…˜**
   - LOOP_JOIN: ëŒ€ë¶€ë¶„ì˜ ê²½ìš° ì„±ëŠ¥ ì €í•˜
   - ì¼ë¶€ AGGREGATE ì•¡ì…˜: 73% ì €í•˜ (Query 24)

### 7.2 SQL Server ìµœì í™” ì¸ì‚¬ì´íŠ¸

1. **ì˜µí‹°ë§ˆì´ì € ì‹ ë¢°**
   - SQL Server ì˜µí‹°ë§ˆì´ì €ê°€ ì´ë¯¸ ì¢‹ì€ í”Œëœ ìƒì„±
   - ë¬´ì‘ìœ„ íŒíŠ¸ëŠ” ì˜¤íˆë ¤ ë°©í•´ê°€ ë  ìˆ˜ ìˆìŒ

2. **íŒíŠ¸ì˜ ì–‘ë©´ì„±**
   - íŠ¹ì • ìƒí™©ì—ì„œë§Œ íš¨ê³¼ì  (Query 10, 21)
   - ëŒ€ë¶€ë¶„ì˜ ê²½ìš° ê¸°ë³¸ í”Œëœì´ ë” ë‚˜ìŒ

3. **ì¿¼ë¦¬ ë³µì¡ë„ì˜ ì˜í–¥**
   - ë‹¨ìˆœ ì¿¼ë¦¬: íŒíŠ¸ íš¨ê³¼ ë¯¸ë¯¸
   - ë³µì¡í•œ ì¿¼ë¦¬: íŒíŠ¸ê°€ ì—­íš¨ê³¼ë¥¼ ë‚¼ ìœ„í—˜ ë†’ìŒ

---

## 8. ë¬¸ì œì  ë° í•´ê²° ê³¼ì œ

### 8.1 ì¦‰ì‹œ í•´ê²° í•„ìš” (Critical)

#### ğŸ”´ **1. ì¿¼ë¦¬ ì‹¤í–‰ ì‹¤íŒ¨ (20% ì¿¼ë¦¬)**

**ë¬¸ì œ**: Query 11, 12, 15, 23, 26, 29ê°€ 0ms ë°˜í™˜

**ê°€ëŠ¥í•œ ì›ì¸**:
- íƒ€ì„ì•„ì›ƒ (30ì´ˆ ì œí•œ)
- `OPTION (RECOMPILE)` + íŠ¹ì • íŒíŠ¸ ì¡°í•©ì˜ ì¶©ëŒ
- í…Œì´ë¸” ë°ì´í„° ë¶€ì¡± ë˜ëŠ” ë½ ì´ìŠˆ
- í™˜ê²½ë³„ ì°¨ì´ (DQN env vs PPO env vs DDPG env)

**í•´ê²° ë°©ì•ˆ**:
```python
# 1. íƒ€ì„ì•„ì›ƒ ì¦ê°€
command_timeout = 60  # 30ì´ˆ â†’ 60ì´ˆ

# 2. ì—ëŸ¬ ì²˜ë¦¬ ê°•í™”
try:
    result = execute_query(sql)
except TimeoutError:
    log_failure(query_id, "TIMEOUT")
    return baseline_ms  # ì‹¤íŒ¨ì‹œ baseline ë°˜í™˜
except Exception as e:
    log_failure(query_id, str(e))
    return baseline_ms

# 3. ì‹¤íŒ¨í•œ ì•¡ì…˜ ë¸”ë™ë¦¬ìŠ¤íŠ¸
QUERY_ACTION_BLACKLIST = {
    11: [5],  # LOOP_JOIN
    12: [14, 15, 16],  # FAST N
    # ...
}
```

#### ğŸ”´ **2. LOOP_JOINì˜ ì¼ê´€ëœ ì—­íš¨ê³¼**

**ë¬¸ì œ**: JOIN_HEAVY ì¿¼ë¦¬ì—ì„œ í‰ê·  35% ì„±ëŠ¥ ì €í•˜

**í•´ê²° ë°©ì•ˆ**:
```python
# Query Routerì—ì„œ LOOP_JOIN ì°¨ë‹¨ (JOIN_HEAVY)
def filter_actions(self, query_type: str, actions: List[int]) -> List[int]:
    if query_type == "JOIN_HEAVY":
        # LOOP_JOIN(5) ì œê±°
        return [a for a in actions if a != 5]
    return actions
```

#### ğŸ”´ **3. ë‚®ì€ Win Rate (19.7%)**

**ë¬¸ì œ**: ëŒ€ë¶€ë¶„ì˜ ê²½ìš° ìµœì í™”ê°€ íš¨ê³¼ ì—†ê±°ë‚˜ ì—­íš¨ê³¼

**í•´ê²° ë°©ì•ˆ**:
- **ë³´ìˆ˜ì  ì ‘ê·¼**: Win Rateë³´ë‹¤ Safe Rate ìš°ì„ 
- **ì„ íƒì  ìµœì í™”**: ê°œì„  ê°€ëŠ¥ì„±ì´ ë†’ì€ ì¿¼ë¦¬ë§Œ ìµœì í™”
- **í•™ìŠµ ë°ì´í„° ì¬ê²€í† **: ëª¨ë¸ì´ í•™ìŠµí•œ ë°ì´í„°ê°€ í˜„ì¬ ì›Œí¬ë¡œë“œì™€ ë§ëŠ”ì§€ í™•ì¸

### 8.2 ì¤‘ê¸° ê°œì„  ê³¼ì œ (Medium Priority)

#### âš ï¸ **1. ëª¨ë¸ë³„ ì „ë¬¸í™”**

í˜„ì¬ëŠ” ëª¨ë“  ëª¨ë¸ì´ ëª¨ë“  ì¿¼ë¦¬ë¥¼ ì²˜ë¦¬í•˜ì§€ë§Œ, ê° ëª¨ë¸ì„ íŠ¹ì • ì¿¼ë¦¬ íƒ€ì…ì— ì „ë¬¸í™”:

```python
MODEL_SPECIALIZATION = {
    "DQN_v4": ["SIMPLE", "TOP"],      # ë‹¨ìˆœ ì¿¼ë¦¬
    "PPO_v3": ["JOIN_HEAVY", "CTE"],  # ë³µì¡í•œ ì¿¼ë¦¬
    "DDPG_v1": ["AGGREGATE"],         # ì§‘ê³„ ì¿¼ë¦¬
    "SAC_v1": ["WINDOW", "SUBQUERY"]  # ë¶„ì„ ì¿¼ë¦¬
}

def route_to_specialists(query_type: str) -> List[str]:
    """ì¿¼ë¦¬ íƒ€ì…ì— ë§ëŠ” ì „ë¬¸ ëª¨ë¸ë§Œ íˆ¬í‘œ"""
    specialists = MODEL_SPECIALIZATION.get(query_type, [])
    return [m for m, types in MODEL_SPECIALIZATION.items() 
            if query_type in types]
```

#### âš ï¸ **2. ì‹ ë¢°ë„ ê¸°ë°˜ ê°€ì¤‘ì¹˜**

ê° ëª¨ë¸ì˜ ì˜ˆì¸¡ ì‹ ë¢°ë„ë¥¼ ê³ ë ¤í•œ ê°€ì¤‘ íˆ¬í‘œ:

```python
def confidence_weighted_vote(
    predictions: Dict[str, int],
    confidences: Dict[str, float],
    query_type: str
) -> int:
    """ì‹ ë¢°ë„ ê¸°ë°˜ ê°€ì¤‘ íˆ¬í‘œ"""
    # ì¿¼ë¦¬ íƒ€ì…ë³„ ëª¨ë¸ ì‹ ë¢°ë„
    trust_scores = {
        "DQN_v4": 0.8 if query_type == "SIMPLE" else 0.5,
        "PPO_v3": 0.8 if query_type == "JOIN_HEAVY" else 0.5,
        "DDPG_v1": 0.6,  # ì•„ì§ ê²€ì¦ ë¶€ì¡±
        "SAC_v1": 0.6
    }
    
    weighted_votes = {}
    for model, action in predictions.items():
        weight = confidences[model] * trust_scores[model]
        weighted_votes[action] = weighted_votes.get(action, 0) + weight
    
    return max(weighted_votes, key=weighted_votes.get)
```

#### âš ï¸ **3. ë™ì  ì•¡ì…˜ í•„í„°ë§**

ëŸ°íƒ€ì„ì— í•™ìŠµë˜ëŠ” ì•¡ì…˜ íš¨ê³¼ì„±:

```python
class AdaptiveActionFilter:
    def __init__(self):
        # ì•¡ì…˜ë³„ ì„±ê³µ/ì‹¤íŒ¨ ì´ë ¥
        self.action_history = defaultdict(lambda: {"success": 0, "failure": 0})
    
    def record_result(self, action: int, speedup: float):
        if speedup > 1.05:
            self.action_history[action]["success"] += 1
        elif speedup < 0.95:
            self.action_history[action]["failure"] += 1
    
    def get_action_score(self, action: int) -> float:
        """ì•¡ì…˜ì˜ ì‹ ë¢°ë„ ì ìˆ˜ (0-1)"""
        history = self.action_history[action]
        total = history["success"] + history["failure"]
        if total < 10:  # ì¶©ë¶„í•œ ë°ì´í„° ì—†ìœ¼ë©´ ì¤‘ë¦½
            return 0.5
        return history["success"] / total
    
    def should_block(self, action: int) -> bool:
        """ì‹¤íŒ¨ìœ¨ 70% ì´ìƒì´ë©´ ì°¨ë‹¨"""
        return self.get_action_score(action) < 0.3
```

### 8.3 ì¥ê¸° ê°œì„  ê³¼ì œ (Long-term)

#### ğŸ“Š **1. ì¬í•™ìŠµ**

í˜„ì¬ ëª¨ë¸ë“¤ì´ í•™ìŠµí•œ ë°ì´í„°ì™€ ì‹¤ì œ ì›Œí¬ë¡œë“œì˜ ë¶ˆì¼ì¹˜ ê°€ëŠ¥ì„±:

```python
# í˜„ì¬ í‰ê°€ ë°ì´í„°ë¥¼ ìƒˆë¡œìš´ í•™ìŠµ ë°ì´í„°ë¡œ í™œìš©
python collect_training_data.py \
    --source evaluation_results.json \
    --output new_training_data.parquet

python train_dqn_v5.py \
    --data new_training_data.parquet \
    --episodes 100000
```

#### ğŸ“Š **2. Meta-Learning**

ì–´ë–¤ ì¿¼ë¦¬ì— ìµœì í™”ë¥¼ ì ìš©í• ì§€ ë°°ìš°ëŠ” ë©”íƒ€ ëª¨ë¸:

```python
class OptimizationDecider:
    """ìµœì í™” ì ìš© ì—¬ë¶€ë¥¼ ê²°ì •í•˜ëŠ” ë©”íƒ€ ëª¨ë¸"""
    
    def should_optimize(self, query_features: np.ndarray) -> bool:
        """
        ì¿¼ë¦¬ íŠ¹ì„±ì„ ë³´ê³  ìµœì í™” ì ìš© ì—¬ë¶€ ê²°ì •
        - ë³µì¡ë„
        - ì˜ˆìƒ ì‹¤í–‰ ì‹œê°„
        - í…Œì´ë¸” í¬ê¸°
        - ì¡°ì¸ ìˆ˜
        """
        return self.meta_model.predict(query_features) > 0.5
```

#### ğŸ“Š **3. Ensemble v3 ë°©í–¥ì„±**

v2ì˜ êµí›ˆì„ ë°”íƒ•ìœ¼ë¡œ í•œ ì°¨ì„¸ëŒ€ ì•™ìƒë¸”:

```python
# Ensemble v3 ì»¨ì…‰
class EnsembleV3:
    """
    í•µì‹¬ ê°œì„ ì‚¬í•­:
    1. ëª¨ë¸ ì „ë¬¸í™” (Query Typeë³„ ì „ë¬¸ ëª¨ë¸)
    2. ì‹ ë¢°ë„ ê¸°ë°˜ ê°€ì¤‘ì¹˜
    3. ë™ì  ì•¡ì…˜ ë¸”ë™ë¦¬ìŠ¤íŠ¸
    4. ë©”íƒ€ ëª¨ë¸ (ìµœì í™” ì ìš© ì—¬ë¶€ ê²°ì •)
    5. ì¬í•™ìŠµëœ ëª¨ë¸ (í˜„ì¬ ì›Œí¬ë¡œë“œ ë°˜ì˜)
    """
    
    def __init__(self):
        self.specialists = {
            "SIMPLE": DQN_v5(),
            "TOP": PPO_v4(),
            "JOIN_HEAVY": DDPG_v2(),
            "AGGREGATE": SAC_v2()
        }
        self.meta_learner = OptimizationDecider()
        self.adaptive_filter = AdaptiveActionFilter()
    
    def predict(self, state, query_type):
        # 1. ë©”íƒ€ ëª¨ë¸ì´ ìµœì í™” í•„ìš”ì„± íŒë‹¨
        if not self.meta_learner.should_optimize(state):
            return NO_ACTION
        
        # 2. ì „ë¬¸ ëª¨ë¸ ì„ íƒ
        specialist = self.specialists[query_type]
        action = specialist.predict(state)
        
        # 3. ë™ì  í•„í„°ë§
        if self.adaptive_filter.should_block(action):
            return NO_ACTION
        
        return action
```

---

## 9. ê²°ë¡ 

### 9.1 Ensemble v2 í‰ê°€ ê²°ê³¼

| í•­ëª© | ëª©í‘œ | ë‹¬ì„± ì—¬ë¶€ | í‰ê°€ |
|------|------|-----------|------|
| **DDPG/SAC í™œì„±í™”** | âœ… | âœ… | ì„±ê³µ |
| **PPO ì•¡ì…˜ ë§¤í•‘** | âœ… | âœ… | ì„±ê³µ |
| **TOP ì¿¼ë¦¬ ê°œì„ ** | âœ… | âŒ | **ì‹¤íŒ¨** (0.792x) |
| **Safe Rate í–¥ìƒ** | âœ… | âš ï¸ | ë¶€ë¶„ ì„±ê³µ (61%) |
| **Win Rate í–¥ìƒ** | âœ… | âŒ | **ì‹¤íŒ¨** (19.7%) |

### 9.2 í•µì‹¬ ë©”ì‹œì§€

#### âœ… **ê¸°ìˆ ì ìœ¼ë¡œëŠ” ì„±ê³µ**
- ì„œë¡œ ë‹¤ë¥¸ 4ê°œ ëª¨ë¸ì„ ì„±ê³µì ìœ¼ë¡œ í†µí•©
- ì•¡ì…˜ ìŠ¤í˜ì´ìŠ¤ ë¶ˆì¼ì¹˜ ë¬¸ì œ í•´ê²°
- ì¿¼ë¦¬ ìºì‹œ ì´ìŠˆ í•´ê²°

#### âŒ **ì„±ëŠ¥ì ìœ¼ë¡œëŠ” ì‹¤íŒ¨**
- TOP, JOIN_HEAVY ì¿¼ë¦¬ì—ì„œ ëª©í‘œ ë¯¸ë‹¬ì„±
- ë‚®ì€ Win Rate (19.7%)
- 20% ì¿¼ë¦¬ì—ì„œ ì‹¤í–‰ ì‹¤íŒ¨

#### ğŸ’¡ **í•µì‹¬ êµí›ˆ**

1. **SQL Server ì˜µí‹°ë§ˆì´ì €ë¥¼ ê³¼ì†Œí‰ê°€í•˜ì§€ ë§ ê²ƒ**
   - ê¸°ë³¸ í”Œëœì´ ì´ë¯¸ ì¶©ë¶„íˆ ì¢‹ìŒ
   - ë¬´ì‘ìœ„ íŒíŠ¸ëŠ” ì˜¤íˆë ¤ ë°©í•´

2. **ëª¨ë¸ í™œì„±í™” â‰  ì„±ëŠ¥ í–¥ìƒ**
   - DDPG/SACê°€ íˆ¬í‘œì— ì°¸ì—¬í–ˆì§€ë§Œ ì„±ëŠ¥ ê°œì„ ì€ ë¯¸ë¯¸
   - ëª¨ë¸ ìˆ˜ê°€ ë§ë‹¤ê³  í•­ìƒ ì¢‹ì€ ê²ƒì€ ì•„ë‹˜

3. **ë³´ìˆ˜ì  ì ‘ê·¼ì´ ë” ì•ˆì „**
   - NO_ACTIONì´ ê°€ì¥ ì•ˆì „í•˜ê³  íš¨ê³¼ì 
   - Safe Rateë¥¼ Win Rateë³´ë‹¤ ìš°ì„ ì‹œí•´ì•¼

### 9.3 ìµœì¢… ê¶Œì¥ì‚¬í•­

#### ğŸ¯ **ë‹¨ê¸° (ì¦‰ì‹œ ì ìš©)**
1. LOOP_JOIN ì•¡ì…˜ ì°¨ë‹¨ (JOIN_HEAVY ì¿¼ë¦¬)
2. ì‹¤íŒ¨ ì¿¼ë¦¬ ì›ì¸ ì¡°ì‚¬ ë° íƒ€ì„ì•„ì›ƒ ì¦ê°€
3. Safety-First íˆ¬í‘œ ì „ëµìœ¼ë¡œ íšŒê·€ (ë” ë³´ìˆ˜ì ìœ¼ë¡œ)

#### ğŸ¯ **ì¤‘ê¸° (1-2ì£¼)**
1. ëª¨ë¸ë³„ ì „ë¬¸í™” êµ¬í˜„
2. ì‹ ë¢°ë„ ê¸°ë°˜ ê°€ì¤‘ íˆ¬í‘œ
3. ë™ì  ì•¡ì…˜ ë¸”ë™ë¦¬ìŠ¤íŠ¸

#### ğŸ¯ **ì¥ê¸° (1-2ê°œì›”)**
1. í˜„ì¬ ì›Œí¬ë¡œë“œë¡œ ëª¨ë¸ ì¬í•™ìŠµ
2. ë©”íƒ€ ëª¨ë¸ ê°œë°œ (ìµœì í™” ì ìš© ì—¬ë¶€ ê²°ì •)
3. Ensemble v3 ì„¤ê³„ ë° êµ¬í˜„

---

## ğŸ“š **ë¶€ë¡**

### A. ì‹¤í—˜ í™˜ê²½

- **ë°ì´í„°ë² ì´ìŠ¤**: SQL Server (TradingDB)
- **Python ë²„ì „**: 3.x
- **ì£¼ìš” ë¼ì´ë¸ŒëŸ¬ë¦¬**: 
  - Stable-Baselines3 (DQN, PPO)
  - Custom DDPG/SAC implementation
- **í‰ê°€ ê·œëª¨**: 30 ì¿¼ë¦¬ Ã— 10 ì—í”¼ì†Œë“œ = 300íšŒ

### B. ëª¨ë¸ ìƒì„¸

| Model | Action Space | Observation Space | í•™ìŠµ ì—í”¼ì†Œë“œ | íŒŒì¼ |
|-------|--------------|-------------------|---------------|------|
| DQN v4 | 19 (Discrete) | 79-dim | 50,000 | `dqn_v4_final.zip` |
| PPO v3 | 44 (Discrete) | 18-dim | 50,000 | `ppo_v3_realdb_50k.zip` |
| DDPG v1 | 7 (Continuous) | 18-dim | ? | `ddpg_v1_realdb_partial.zip` |
| SAC v1 | 7 (Continuous) | 18-dim | ? | `sac_v1_realdb_partial.zip` |

### C. ì•¡ì…˜ ìŠ¤í˜ì´ìŠ¤ (DQN v4 ê¸°ì¤€)

```python
ACTION_SPACE = {
    0: "SET_MAXDOP_1",
    1: "SET_MAXDOP_2", 
    2: "SET_MAXDOP_4",
    3: "OPTION_HASH_JOIN",
    4: "OPTION_MERGE_JOIN",
    5: "OPTION_LOOP_JOIN",
    6: "OPTION_HASH_GROUP",
    7: "RECOMPILE",
    8: "FORCE_ORDER",
    9: "ROBUST_PLAN",
    10: "FAST_1",
    11: "FAST_5",
    12: "FAST_10",
    13: "FAST_100",
    14: "FAST_5",     # Mapped from PPO
    15: "FAST_10",    # Mapped from PPO
    16: "FAST_50",    # Mapped from PPO
    17: "KEEPFIXED_PLAN",
    18: "NO_ACTION"
}
```

### D. ì°¸ê³  ë¬¸ì„œ

- [Ensemble v1 Final Report](../Ensemble_v1/Ensemble_v1_Final_Report.md)
- [Ensemble v2 Implementation Summary](./IMPLEMENTATION_SUMMARY.md)
- [Ensemble v2 README](./README.md)

---

**ë³´ê³ ì„œ ë**

ìƒì„±ì¼: 2025-10-30  
ì‘ì„±ì: Ensemble v2 í‰ê°€ ì‹œìŠ¤í…œ  
ë²„ì „: 1.0

