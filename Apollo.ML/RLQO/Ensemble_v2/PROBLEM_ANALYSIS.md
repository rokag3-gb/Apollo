# Ensemble v2 ë¬¸ì œ ë¶„ì„ ë³´ê³ ì„œ

## ğŸ“Š í•µì‹¬ ë¬¸ì œ: ì™œ ì•™ìƒë¸”ì—ì„œ ê°œì„ ëœ ì¿¼ë¦¬ê°€ ì ì€ê°€?

### ê°œë³„ ëª¨ë¸ ì„±ëŠ¥ vs ì•™ìƒë¸” ì„±ëŠ¥ ë¹„êµ

| ëª¨ë¸ | í‰ê·  Speedup | ê°œì„ ëœ ì¿¼ë¦¬ ìˆ˜ | Win Rate | ì£¼ìš” ê°•ì  |
|------|-------------|--------------|----------|----------|
| **DDPG v1** | **1.875x** (87.5% ê°œì„ ) | **4ê°œ** (ê·¹ì  ê°œì„ ) | 13.3% | ëŒ€ìš©ëŸ‰ ì¿¼ë¦¬ (Query 2: 17x, Query 3: 4x, Query 5: 5.8x) |
| **SAC v1** | **1.891x** (89.1% ê°œì„ ) | **7ê°œ** | 15.4% | ìµœê³  ì„±ëŠ¥, ë‹¤ì–‘í•œ ì¿¼ë¦¬ ê°œì„  |
| **PPO v3** | **1.199x** (19.9% ê°œì„ ) | **9ê°œ** | 31% | CTE ì¿¼ë¦¬ (1.7x), ë³µì¡í•œ ì¿¼ë¦¬ |
| **DQN v4** | **ê·¹ë‹¨ì ** | **15ê°œ** (ê·¹ì  ê°œì„ /ì•…í™”) | í˜¼í•© | ì¼ë¶€ ì¿¼ë¦¬ 50x, ì¼ë¶€ -10x |
| **Ensemble v2** | **1.051x** (5% ê°œì„ ) | **1ê°œ** (Q8 ì œì™¸) | 19.7% | âŒ **ì‹¤íŒ¨** |

---

## ğŸ” ê·¼ë³¸ ì›ì¸ ë¶„ì„

### 1. **ë‹¤ìˆ˜ê²° íˆ¬í‘œ(Majority Vote)ì˜ ì¹˜ëª…ì  ë¬¸ì œ**

#### ë¬¸ì œ ìƒí™© ì˜ˆì‹œ: Query 2 (ëŒ€ìš©ëŸ‰ í…Œì´ë¸” ìŠ¤ìº”)

```
ê°œë³„ ëª¨ë¸ ì˜ˆì¸¡:
- DDPG v1: Action 15 (MAXDOP=1, FAST=100, ...) â†’ 17.82x ê°œì„ !
- SAC v1: Action 15 (ë™ì¼) â†’ ~18x ê°œì„ !
- PPO v3: Action 18 (NO_ACTION) â†’ 1.0x (ë³€í™” ì—†ìŒ)
- DQN v4: Action 18 (NO_ACTION) â†’ 1.0x (ë³€í™” ì—†ìŒ)

ë‹¤ìˆ˜ê²° íˆ¬í‘œ ê²°ê³¼:
- Action 18 (NO_ACTION): 2í‘œ âœ… ìŠ¹ë¦¬
- Action 15: 2í‘œ âŒ íŒ¨ë°°

ìµœì¢… ê²°ê³¼: NO_ACTION â†’ ê°œì„  ê¸°íšŒ ìƒì‹¤!
```

#### ì‹¤ì œ ë°ì´í„°ë¡œ ê²€ì¦

**DDPG v1 ë‹¨ë… ì‹¤í–‰ ì‹œ**:
```json
{
  "query_idx": 2,
  "query_name": "ëŒ€ìš©ëŸ‰ í…Œì´ë¸” ì „ì²´ ìŠ¤ìº”",
  "avg_speedup": 17.823x,
  "action": "MAXDOP=1, FAST=100, JOIN=FORCE_ORDER, COMPAT_160"
}
```

**Ensemble v2 ì‹¤í–‰ ì‹œ** (ë³´ê³ ì„œ ê¸°ì¤€):
```json
{
  "query_idx": 2,
  "mean_speedup": 0.970x,  // ì˜¤íˆë ¤ 3% ì €í•˜!
  "win_rate": 0.4,
  "safe_rate": 0.5
}
```

â†’ **17x ê°œì„  ê¸°íšŒê°€ ë‹¤ìˆ˜ê²° íˆ¬í‘œë¡œ ì¸í•´ ì™„ì „íˆ ìƒì‹¤ë¨!**

---

### 2. **ë³´ìˆ˜ì  ëª¨ë¸ë“¤ì˜ ì••ë„ì  ì˜í–¥**

ê° ëª¨ë¸ì˜ NO_ACTION ë¹„ìœ¨:
- **DDPG v1**: 83.3% (25/30 ì¿¼ë¦¬)
- **SAC v1**: 76.7% (23/30 ì¿¼ë¦¬)  
- **PPO v3**: 69% (ëŒ€ë¶€ë¶„ ì¿¼ë¦¬)
- **DQN v4**: í˜¼í•© (í•˜ì§€ë§Œ ë§ì€ ì¿¼ë¦¬ì—ì„œ NO_ACTION)

#### íˆ¬í‘œ ì‹œë‚˜ë¦¬ì˜¤ ë¶„ì„

```python
# ì „í˜•ì ì¸ íˆ¬í‘œ ìƒí™© (30ê°œ ì¿¼ë¦¬ ì¤‘ 25ê°œ)
predictions = {
    'ddpg_v1': 18,  # NO_ACTION
    'sac_v1': 18,   # NO_ACTION
    'ppo_v3': 18,   # NO_ACTION
    'dqn_v4': 5     # MAXDOP=1 (ê°œì„  ê°€ëŠ¥í•œ ì•¡ì…˜)
}

majority_vote(predictions)  # â†’ 18 (NO_ACTION) ìŠ¹ë¦¬
```

â†’ **3ê°œ ëª¨ë¸ì´ ë³´ìˆ˜ì ì´ë©´, ë‚˜ë¨¸ì§€ 1ê°œ ëª¨ë¸ì˜ ì¢‹ì€ ì•¡ì…˜ì€ ë¬´ì‹œë¨!**

---

### 3. **ê° ëª¨ë¸ì˜ ì „ë¬¸ì„±(Specialization) ë¬´ì‹œ**

#### ëª¨ë¸ë³„ ê°•ì  ì¿¼ë¦¬ íƒ€ì…

| ëª¨ë¸ | ìµœê³  ì„±ëŠ¥ ì¿¼ë¦¬ íƒ€ì… | í‰ê·  Speedup | ê°œì„  ì¿¼ë¦¬ ì˜ˆì‹œ |
|------|-------------------|-------------|---------------|
| **DDPG v1** | **ëŒ€ìš©ëŸ‰ SIMPLE, ë³µì¡í•œ JOIN** | 1.875x | Q2 (17x), Q3 (4x), Q5 (5.8x), Q28 (2.5x) |
| **SAC v1** | **ëŒ€ìš©ëŸ‰ ì¿¼ë¦¬ + ë‹¤ì–‘ì„±** | 1.891x | Q2 (22x), Q3, Q5, Q28 + 3ê°œ ì¶”ê°€ |
| **PPO v3** | **CTE, JOIN_HEAVY** | 1.704x (CTE) | Q1 (CTE), Q7 (JOIN_HEAVY) |
| **DQN v4** | **ê·¹ë‹¨ì  ì¿¼ë¦¬** | ê·¹ì  ê°œì„ /ì•…í™” | Q5 (50x), Q15 (inf), Q25 (inf) |

#### ë‹¤ìˆ˜ê²° íˆ¬í‘œ ê²°ê³¼

```
Query 2 (SIMPLE, ëŒ€ìš©ëŸ‰):
  âœ… DDPG/SAC ì „ë¬¸ â†’ 17x ê°œì„  ê°€ëŠ¥
  âŒ ë‹¤ìˆ˜ê²° â†’ NO_ACTION (0.97x, ì˜¤íˆë ¤ ì €í•˜)

Query 1 (CTE):
  âœ… PPO v3 ì „ë¬¸ â†’ 1.7x ê°œì„  ê°€ëŠ¥
  âŒ ë‹¤ìˆ˜ê²° â†’ NO_ACTION (1.0x, ë³€í™” ì—†ìŒ)
```

â†’ **ì „ë¬¸ê°€(Specialist) ëª¨ë¸ì˜ ì˜ê²¬ì´ ë¹„ì „ë¬¸ê°€ ë‹¤ìˆ˜ì— ì˜í•´ ë¬»í˜!**

---

### 4. **Voting Strategy ë¬¸ì œ (majority vs safety_first)**

#### Majority Voting (ë³´ê³ ì„œì—ì„œ ì‚¬ìš©)

```python
def majority_vote(predictions: Dict[str, int]) -> int:
    vote_counts = Counter(predictions.values())
    most_common = vote_counts.most_common(1)[0]
    return most_common[0]  # ë‹¨ìˆœ ë‹¤ìˆ˜ê²°
```

**ë¬¸ì œì **:
- Confidence ë¬´ì‹œ
- ëª¨ë¸ë³„ ì„±ëŠ¥ ì°¨ì´ ë¬´ì‹œ
- NO_ACTIONì´ í•­ìƒ ë‹¤ìˆ˜ ì°¨ì§€

#### Safety-First Voting (êµ¬í˜„ë˜ì–´ ìˆìœ¼ë‚˜ ì‚¬ìš© ì•ˆ í•¨)

```python
def safety_first_vote(..., safety_threshold=0.2, disagreement_threshold=0.1):
    # 1. í‰ê·  confidence < 0.2 â†’ NO_ACTION
    # 2. ëª¨ë¸ ê°„ agreement < 10% â†’ NO_ACTION
    # ...
```

**ë¬¸ì œì **:
- ë„ˆë¬´ ë³´ìˆ˜ì  (thresholdê°€ ë„ˆë¬´ ë‚®ìŒ)
- Disagreement threshold 10%ëŠ” ì‚¬ì‹¤ìƒ ë§Œì¥ì¼ì¹˜ ìš”êµ¬
- **ê°œì„  ê¸°íšŒë¥¼ ë”ìš± ì¤„ì„!**

---

## ğŸ“‰ êµ¬ì²´ì  ì‚¬ë¡€: Queryë³„ ë¹„êµ

### ì‚¬ë¡€ 1: Query 2 (ëŒ€ìš©ëŸ‰ í…Œì´ë¸” ìŠ¤ìº”)

| ì‹¤í–‰ ë°©ì‹ | Speedup | ì•¡ì…˜ |
|----------|---------|------|
| DDPG v1 ë‹¨ë… | **17.82x** âœ… | MAXDOP=1, FAST=100, ... |
| SAC v1 ë‹¨ë… | **~18x** âœ… | ë™ì¼ |
| **Ensemble v2** | **0.97x** âŒ | NO_ACTION (3% ì €í•˜!) |

**ì†ì‹¤**: 17x ê°œì„  ê¸°íšŒ ìƒì‹¤

---

### ì‚¬ë¡€ 2: Query 28 (ê±°ë˜ ì›ì¥ ì§‘ê³„)

| ì‹¤í–‰ ë°©ì‹ | Speedup | ì•¡ì…˜ |
|----------|---------|------|
| DDPG v1 ë‹¨ë… | **2.52x** âœ… | MAXDOP=1, FAST=100, ISOLATION=SNAPSHOT, ... |
| **Ensemble v2** | **0.88x** âŒ | (ì—­íš¨ê³¼ ì•¡ì…˜ ì„ íƒ) |

**ì†ì‹¤**: 2.5x ê°œì„  â†’ 12% ì €í•˜

---

### ì‚¬ë¡€ 3: Query 1 (CTE ì¿¼ë¦¬)

| ì‹¤í–‰ ë°©ì‹ | Speedup | ì•¡ì…˜ |
|----------|---------|------|
| PPO v3 ë‹¨ë… | **1.7x** âœ… | (PPO ì „ë¬¸ ì•¡ì…˜) |
| **Ensemble v2** | **1.0x** âŒ | NO_ACTION |

**ì†ì‹¤**: 70% ê°œì„  ê¸°íšŒ ìƒì‹¤

---

## ğŸ¯ í†µê³„ì  ì¦ê±°

### Win Rate ë¹„êµ

```
ê°œë³„ ëª¨ë¸ Win Rate (ê°œì„  ì¿¼ë¦¬ ë¹„ìœ¨):
- SAC v1:  15.4% (7/30 ì¿¼ë¦¬)
- DDPG v1: 13.3% (4/30 ì¿¼ë¦¬)
- PPO v3:  31.0% (9/30 ì¿¼ë¦¬, ë‹¤ìˆ˜ ì—í”¼ì†Œë“œ ê¸°ì¤€)

ì•™ìƒë¸” Win Rate:
- Ensemble v2: 19.7% (59/300 ì—í”¼ì†Œë“œ)
  â†’ ì‹¤ì œ ì¿¼ë¦¬ë³„ë¡œëŠ” ~3ê°œë§Œ ê°œì„  (Q8, Q10, Q21)
  â†’ Q8ì€ ë°ì´í„° ì—†ìŒìœ¼ë¡œ ì¸í•œ ì°©ì‹œ
```

**ê¸°ëŒ€ê°’ vs ì‹¤ì œ**:
- **ê¸°ëŒ€**: ê° ëª¨ë¸ì˜ ê°•ì  í•©ì‚° â†’ 30% ì´ìƒ Win Rate
- **ì‹¤ì œ**: 19.7% (ê°œë³„ ëª¨ë¸ë³´ë‹¤ ë‚®ìŒ!)
- **ì†ì‹¤**: 10ê°œ ì´ìƒì˜ ê°œì„  ì¿¼ë¦¬ ìƒì‹¤

---

### í‰ê·  Speedup ë¹„êµ

```
ê°œë³„ ëª¨ë¸ í‰ê· :
- SAC v1:  1.891x (+89.1%)
- DDPG v1: 1.875x (+87.5%)
- PPO v3:  1.199x (+19.9%)
- í‰ê· :    ~1.655x (+65.5%)

ì•™ìƒë¸” í‰ê· :
- Ensemble v2: 1.051x (+5.1%)

ì†ì‹¤: 60% ì´ìƒì˜ ì„±ëŠ¥ í–¥ìƒ ê¸°íšŒ ìƒì‹¤
```

---

## ğŸ’¡ ì™œ ì´ëŸ° ì¼ì´ ë°œìƒí•˜ëŠ”ê°€?

### 1. **ì§‘ë‹¨ ì§€ì„±(Wisdom of Crowds)ì˜ ì „ì œ ì¡°ê±´ ìœ„ë°˜**

ë‹¤ìˆ˜ê²°ì´ íš¨ê³¼ì ì´ë ¤ë©´:
- âœ… ê° íˆ¬í‘œìê°€ ë…ë¦½ì ì´ê³  ë‹¤ì–‘í•œ ê´€ì ì„ ê°€ì§ â†’ **ë§Œì¡±**
- âŒ **ê° íˆ¬í‘œìê°€ ì¼ì • ìˆ˜ì¤€ ì´ìƒì˜ ì •í™•ë„ë¥¼ ê°€ì§** â†’ **ìœ„ë°˜!**
- âŒ **íˆ¬í‘œìë“¤ì´ ë‹¤ì–‘í•œ ì˜ê²¬ì„ ì œì‹œí•¨** â†’ **ìœ„ë°˜!** (ëŒ€ë¶€ë¶„ NO_ACTION)

í˜„ì¬ ìƒí™©:
- 4ê°œ ëª¨ë¸ ì¤‘ 3ê°œê°€ ëŒ€ë¶€ë¶„ ì¿¼ë¦¬ì—ì„œ NO_ACTION ì„ íƒ
- NO_ACTIONì´ í•­ìƒ ë‹¤ìˆ˜ ì°¨ì§€
- ì „ë¬¸ê°€ ëª¨ë¸ì˜ ì˜ê²¬ì´ ë¬»í˜

---

### 2. **ë¶€ì •ì  íˆ¬í‘œ(Negative Voting) íš¨ê³¼**

```
ì˜ë£Œ ì§„ë‹¨ ë¹„ìœ :
- ì „ë¬¸ì˜ A (ì‹¬ì¥ë³‘ ì „ë¬¸): "ì‹¬ì¥ ìˆ˜ìˆ  í•„ìš”" (95% í™•ì‹ )
- ì „ë¬¸ì˜ B (ì™¸ê³¼ ì „ë¬¸): "ëª¨ë¦„" (NO_ACTION)
- ì „ë¬¸ì˜ C (ë‚´ê³¼ ì „ë¬¸): "ëª¨ë¦„" (NO_ACTION)
- ì „ë¬¸ì˜ D (ì¼ë°˜ì˜): "ëª¨ë¦„" (NO_ACTION)

ë‹¤ìˆ˜ê²° íˆ¬í‘œ: "ëª¨ë¦„" (NO_ACTION) â†’ í™˜ì ì¹˜ë£Œ ì•ˆ í•¨!
```

**ì¿¼ë¦¬ ìµœì í™”ë„ ë™ì¼**:
- DDPGê°€ "ì´ ëŒ€ìš©ëŸ‰ ì¿¼ë¦¬ëŠ” MAXDOP=1 í•„ìš”!"ë¼ê³  95% í™•ì‹ 
- ë‹¤ë¥¸ 3ê°œ ëª¨ë¸ì€ "ì˜ ëª¨ë¥´ê² ìŒ" (NO_ACTION)
- ë‹¤ìˆ˜ê²° â†’ NO_ACTION â†’ **ê°œì„  ê¸°íšŒ ìƒì‹¤**

---

### 3. **ëª¨ë¸ ë‹¤ì–‘ì„±ì´ ì˜¤íˆë ¤ ë…**

```
ê° ëª¨ë¸ì´ ë‹¤ë¥¸ ì¿¼ë¦¬ì—ì„œ ê°œì„ :
- DDPG: Query 2, 3, 5, 28 (4ê°œ)
- SAC:  Query 2, 3, 5, 28 + Î± (7ê°œ)
- PPO:  Query 1, 7, 10, ... (9ê°œ)
- DQN:  Query 5, 15, 25, ... (15ê°œ, í•˜ì§€ë§Œ ì ˆë°˜ì€ ì•…í™”)

ë‹¤ìˆ˜ê²° íˆ¬í‘œ ì‹œ:
- Query 2: DDPG/SACë§Œ ê°œì„  ì•¡ì…˜ â†’ 2í‘œ vs 2í‘œ â†’ ë¬´ì‘ìœ„ ë˜ëŠ” NO_ACTION
- Query 1: PPOë§Œ ê°œì„  ì•¡ì…˜ â†’ 1í‘œ vs 3í‘œ â†’ NO_ACTION
- Query 10: PPOë§Œ ê°œì„  ì•¡ì…˜ â†’ 1í‘œ vs 3í‘œ â†’ NO_ACTION
```

â†’ **ê° ëª¨ë¸ì˜ ì „ë¬¸ì„±ì´ ì„œë¡œ ë‹¤ë¥¸ ì¿¼ë¦¬ì— ë¶„ì‚°ë˜ì–´ ìˆì–´, ë‹¤ìˆ˜ê²°ì—ì„œ ëª¨ë‘ ë¬´ì‹œë¨!**

---

## ğŸš¨ ê²°ë¡ 

### í•µì‹¬ ë¬¸ì œ ìš”ì•½

1. **ë‹¤ìˆ˜ê²° íˆ¬í‘œì˜ êµ¬ì¡°ì  ë¬¸ì œ**
   - 3ê°œ ëª¨ë¸ì´ NO_ACTION â†’ 1ê°œ ì „ë¬¸ê°€ ëª¨ë¸ì˜ ì˜ê²¬ ë¬´ì‹œ
   - ê°œì„  ê°€ëŠ¥í•œ ì¿¼ë¦¬ì˜ 80% ì´ìƒì—ì„œ NO_ACTION ìŠ¹ë¦¬

2. **ë³´ìˆ˜ì  ëª¨ë¸ë“¤ì˜ ê³¼ë‹¤í•œ ì˜í–¥**
   - DDPG/SAC/PPO ëª¨ë‘ 70% ì´ìƒ NO_ACTION
   - ì•ˆì „ì„±ì€ ë†’ì§€ë§Œ ê°œì„  ê¸°íšŒ ìƒì‹¤

3. **ëª¨ë¸ë³„ ì „ë¬¸ì„± ë¬´ì‹œ**
   - ê° ëª¨ë¸ì´ ë‹¤ë¥¸ ì¿¼ë¦¬ íƒ€ì…ì—ì„œ ê°•ì 
   - ë‹¤ìˆ˜ê²°ì€ ì „ë¬¸ì„±ì„ ë¬´ì‹œí•˜ê³  ë‹¤ìˆ˜ë§Œ ë´„

4. **Voting Strategy ë¬¸ì œ**
   - `majority` íˆ¬í‘œ: Confidence, ì„±ëŠ¥ ë¬´ì‹œ
   - `safety_first` íˆ¬í‘œ: ë„ˆë¬´ ë³´ìˆ˜ì  (ë” ì•ˆ ì¢‹ìŒ)

---

### ìˆ˜ì¹˜ë¡œ ë³¸ ì†ì‹¤

| ì§€í‘œ | ê°œë³„ ëª¨ë¸ í‰ê·  | Ensemble v2 | ì†ì‹¤ |
|-----|--------------|------------|-----|
| **í‰ê·  Speedup** | 1.655x | 1.051x | **-60% ì„±ëŠ¥ ì†ì‹¤** |
| **ê°œì„  ì¿¼ë¦¬ ìˆ˜** | ~10ê°œ | 1ê°œ (ì‹¤ì§ˆì ) | **-9ê°œ ì¿¼ë¦¬ ì†ì‹¤** |
| **ìµœëŒ€ Speedup** | 18~22x | 10x (ì°©ì‹œ) | **-ì ˆë°˜ ì´ìƒ ì†ì‹¤** |

â†’ **ì•™ìƒë¸”ì´ ê°œë³„ ëª¨ë¸ë³´ë‹¤ í›¨ì”¬ ë‚˜ì¨!**

---

## ğŸ“‹ ë‹¤ìŒ ë‹¨ê³„: í•´ê²° ë°©ì•ˆ

ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ë ¤ë©´:

1. âœ… **Confidence ê¸°ë°˜ íˆ¬í‘œ ê°•í™”**
2. âœ… **ì¿¼ë¦¬ íƒ€ì…ë³„ ì „ë¬¸ê°€ ëª¨ë¸ ìš°ì„  ì„ íƒ**
3. âœ… **NO_ACTION íˆ¬í‘œ ì œì™¸ (Active-Only Voting)**
4. âœ… **ëª¨ë¸ë³„ ì„±ëŠ¥ ê¸°ë°˜ ê°€ì¤‘ì¹˜**
5. âœ… **Conservative Threshold ì™„í™”**

ìì„¸í•œ í•´ê²°ì±…ì€ ë³„ë„ ì œì•ˆì„œì—ì„œ ì œê³µ.

